{
  "project": "Beat Buddy",
  "version": "1.0.0",
  "last_updated": "2026-02-04",
  "branchName": "main",
  "userStories": [
    {
      "id": "US-001",
      "title": "Настройка параметров метронома",
      "description": "Как педагог я хочу настроить темп (BPM) и время занятия, чтобы подготовить занятие для ребёнка",
      "acceptanceCriteria": [
        "UI с ползунком темпа (диапазон TBD, ориентировочно 40-200 BPM)",
        "Поле ввода времени занятия (минуты)",
        "Большие элементы управления (минимум 60px высота кнопок)",
        "Яркие цвета, чёткий контраст",
        "Валидация: BPM в допустимом диапазоне, время > 0",
        "Настройки сохраняются в localStorage",
        "UI протестирован на читаемость для детей",
        "Код соответствует CLAUDE.md (типы, guard clauses)"
      ],
      "priority": 1,
      "passes": true,
      "technicalNotes": "Чистый HTML/CSS/JS, localStorage для сохранения настроек между сессиями",
      "relatedFiles": ["src/web/index.html", "src/web/styles/main.css", "src/web/js/app.js"]
    },
    {
      "id": "US-002",
      "title": "Точный метроном с низкой задержкой",
      "description": "Как система я должна воспроизвести метроном с заданным темпом через наушники с минимальной задержкой (<10ms)",
      "acceptanceCriteria": [
        "Метроном использует Web Audio API (не setTimeout/setInterval)",
        "Задержка < 10ms",
        "Стабильный темп без дрифта",
        "Звук клика слышен в наушниках",
        "Кнопки Start/Stop",
        "Метроном работает с заданным BPM",
        "Измерена задержка (должна быть < 10ms)",
        "Нет дрифта при длительной работе (10+ минут)",
        "Код в отдельном модуле (например, MetronomeEngine.js)"
      ],
      "priority": 2,
      "passes": true,
      "technicalNotes": "Web Audio API: AudioContext, currentTime для scheduling. Запрещено использовать setTimeout/setInterval для тайминга. Модуль должен экспортировать: start(bpm), stop(), isPlaying()",
      "relatedFiles": ["src/web/js/MetronomeEngine.js", "src/web/js/app.js", "src/web/index.html", "src/web/styles/main.css"]
    },
    {
      "id": "US-003",
      "title": "Регистрация ударов (dev-режим с клавиатурой)",
      "description": "Как разработчик я хочу эмулировать удары по датчику через клавиатуру для тестирования без физического датчика",
      "acceptanceCriteria": [
        "Нажатие пробела регистрируется как удар",
        "События ударов логируются",
        "Переключение между KeyboardSensor и MicrophoneSensor через UI или конфиг",
        "Чёткий API: connect(), disconnect(), onHit(callback)",
        "KeyboardSensor реализован",
        "Можно переключить режим (dev/prod)",
        "События ударов ловятся корректно",
        "Код в изолированном модуле (SensorManager.js)",
        "Модуль логирует все события подключения"
      ],
      "priority": 3,
      "passes": false,
      "technicalNotes": "Модуль SensorManager.js с двумя реализациями: KeyboardSensor, MicrophoneSensor. Интерфейс: connect(), disconnect(), onHit(callback), getStatus(). Конфиг: переключение через localStorage или чекбокс Dev Mode",
      "relatedFiles": ["src/web/js/SensorManager.js", "src/web/js/sensors/KeyboardSensor.js"]
    },
    {
      "id": "US-004",
      "title": "Регистрация ударов с реального датчика",
      "description": "Как система я должна читать удары с датчика, подключённого через мини-джек (определяется как микрофон)",
      "acceptanceCriteria": [
        "Датчик подключается через navigator.mediaDevices.getUserMedia()",
        "Обработка аудиопотока через AudioContext.createMediaStreamSource()",
        "Определение удара по превышению порога амплитуды",
        "Нет ложных срабатываний от фоновых шумов",
        "Логирование событий подключения",
        "MicrophoneSensor реализован",
        "Датчик регистрирует прямые удары",
        "Нет ложных срабатываний",
        "Проблема подключения с 5-й попытки решена (изолирован в модуль)",
        "Тесты на реальном датчике"
      ],
      "priority": 4,
      "passes": false,
      "technicalNotes": "КРИТИЧНО: Изолировать логику подключения в SensorManager.js. Проблема: в нашем приложении датчик работал только с 5-й попытки, хотя в системе и на сторонних сайтах — с первого раза. Порог срабатывания TBD (определим при тестировании). Модуль должен логировать все попытки подключения",
      "relatedFiles": ["src/web/js/SensorManager.js", "src/web/js/sensors/MicrophoneSensor.js"]
    },
    {
      "id": "US-005",
      "title": "Анализ точности попадания в ритм",
      "description": "Как система я должна определить, попал ли удар в такт метронома, и вычислить отклонение",
      "acceptanceCriteria": [
        "Сравнение времени удара с временем бита метронома",
        "Определение попал/промах по порогу (TBD, ±50ms / ±100ms)",
        "Хранение статистики: количество ударов, количество попаданий",
        "Расчёт процента точности",
        "Алгоритм анализа реализован",
        "Порог точности подобран при тестировании",
        "Статистика накапливается в течение занятия",
        "Тесты на граничные случаи (удар точно в бит, удар с отклонением)"
      ],
      "priority": 5,
      "passes": false,
      "technicalNotes": "Модуль RhythmAnalyzer.js. Методы: analyzeHit(hitTime, beatTime), getAccuracy(), reset(). Логика: |hitTime - beatTime| <= threshold → попадание",
      "relatedFiles": ["src/web/js/RhythmAnalyzer.js"]
    },
    {
      "id": "US-006",
      "title": "Визуальная обратная связь (анимация)",
      "description": "Как ребёнок я хочу видеть, попал ли я в ритм (зелёный = успех, красный = промах)",
      "acceptanceCriteria": [
        "Одна локация с простой анимацией (круг/фигура)",
        "При попадании: зелёный цвет, успешная анимация",
        "При промахе: красный цвет, анимация ошибки",
        "Анимация синхронизирована с метрономом (пульсирует в такт)",
        "Минимум текста, максимум визуальной обратной связи",
        "Анимация реализована (Canvas или CSS)",
        "Реагирует на события ударов",
        "Понятна детям 3-15 лет (проверено с тестерами)",
        "Плавная, без лагов"
      ],
      "priority": 6,
      "passes": false,
      "technicalNotes": "Canvas или CSS animations. Подписка на события из RhythmAnalyzer. Простая анимация: круг растёт/сжимается в такт метроному",
      "relatedFiles": ["src/web/js/Animator.js", "src/web/styles/main.css"]
    },
    {
      "id": "US-007",
      "title": "Экран статистики после занятия",
      "description": "Как педагог я хочу увидеть результаты занятия (процент точности, количество ударов)",
      "acceptanceCriteria": [
        "Показывается после окончания времени или нажатия Стоп",
        "Отображает: процент точности, количество ударов, время занятия",
        "Большие цифры, понятные детям",
        "Кнопка Новое занятие для возврата в меню",
        "Экран статистики реализован",
        "Данные корректны (сверены с логами)",
        "UI читаемый и яркий",
        "Возврат в меню работает"
      ],
      "priority": 7,
      "passes": false,
      "technicalNotes": "Простой HTML/CSS экран. Данные берутся из RhythmAnalyzer",
      "relatedFiles": ["src/web/index.html", "src/web/styles/main.css", "src/web/js/app.js"]
    },
    {
      "id": "US-008",
      "title": "Управление занятием (Start/Stop, таймер)",
      "description": "Как педагог я хочу запустить занятие, остановить досрочно, видеть оставшееся время",
      "acceptanceCriteria": [
        "Кнопка Старт запускает метроном, датчик и таймер",
        "Кнопка Стоп останавливает всё и показывает статистику",
        "Таймер показывает оставшееся время",
        "По истечении времени автоматически переход к статистике",
        "Кнопки работают",
        "Таймер корректен",
        "Автоматическое завершение по таймеру",
        "Все модули (метроном, датчик, анализ) синхронизированы"
      ],
      "priority": 8,
      "passes": false,
      "technicalNotes": "Координация между MetronomeEngine, SensorManager, RhythmAnalyzer. Таймер через setInterval (некритично для точности). Переход между экранами: Setup → Session → Stats",
      "relatedFiles": ["src/web/js/app.js", "src/web/index.html"]
    }
  ]
}
