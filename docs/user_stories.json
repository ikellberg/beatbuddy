{
  "project": "Beat Buddy",
  "version": "2.0.0",
  "last_updated": "2026-02-07",
  "branchName": "main",
  "userStories": [
    {
      "id": "US-001",
      "phase": "mvp",
      "title": "Настройка параметров метронома",
      "description": "Как педагог я хочу настроить темп (BPM) и время занятия, чтобы подготовить занятие для ребёнка",
      "acceptanceCriteria": [
        "UI с ползунком темпа (диапазон 50-70 BPM)",
        "Поле ввода времени занятия (минуты)",
        "Большие элементы управления (минимум 60px высота кнопок)",
        "Яркие цвета, чёткий контраст",
        "Валидация: BPM в допустимом диапазоне, время > 0",
        "Настройки сохраняются в localStorage",
        "UI протестирован на читаемость для детей",
        "Код соответствует CLAUDE.md (типы, guard clauses)"
      ],
      "priority": 1,
      "passes": true,
      "technicalNotes": "Чистый HTML/CSS/JS, localStorage для сохранения настроек между сессиями",
      "relatedFiles": ["src/web/index.html", "src/web/styles/main.css", "src/web/js/app.js"]
    },
    {
      "id": "US-002",
      "phase": "mvp",
      "title": "Точный метроном с низкой задержкой",
      "description": "Как система я должна воспроизвести метроном с заданным темпом через наушники с минимальной задержкой (<10ms)",
      "acceptanceCriteria": [
        "Метроном использует Web Audio API (не setTimeout/setInterval)",
        "Задержка < 10ms",
        "Стабильный темп без дрифта",
        "Звук клика слышен в наушниках",
        "Кнопки Start/Stop",
        "Метроном работает с заданным BPM",
        "Измерена задержка (должна быть < 10ms)",
        "Нет дрифта при длительной работе (10+ минут)",
        "Код в отдельном модуле (например, MetronomeEngine.js)"
      ],
      "priority": 2,
      "passes": true,
      "technicalNotes": "Web Audio API: AudioContext, currentTime для scheduling. Запрещено использовать setTimeout/setInterval для тайминга. Модуль должен экспортировать: start(bpm), stop(), isPlaying()",
      "relatedFiles": ["src/web/js/MetronomeEngine.js", "src/web/js/app.js", "src/web/index.html", "src/web/styles/main.css"]
    },
    {
      "id": "US-003",
      "phase": "mvp",
      "title": "Регистрация ударов (dev-режим с клавиатурой)",
      "description": "Как разработчик я хочу эмулировать удары по датчику через клавиатуру для тестирования без физического датчика",
      "acceptanceCriteria": [
        "Нажатие пробела регистрируется как удар",
        "События ударов логируются",
        "Переключение между KeyboardSensor и MicrophoneSensor через UI или конфиг",
        "Чёткий API: connect(), disconnect(), onHit(callback)",
        "KeyboardSensor реализован",
        "Можно переключить режим (dev/prod)",
        "События ударов ловятся корректно",
        "Код в изолированном модуле (SensorManager.js)",
        "Модуль логирует все события подключения"
      ],
      "priority": 3,
      "passes": true,
      "technicalNotes": "Модуль SensorManager.js с двумя реализациями: KeyboardSensor, MicrophoneSensor. Интерфейс: connect(), disconnect(), onHit(callback), getStatus(). Конфиг: переключение через localStorage или чекбокс Dev Mode",
      "relatedFiles": ["src/web/js/SensorManager.js", "src/web/js/sensors/KeyboardSensor.js"]
    },
    {
      "id": "US-004",
      "phase": "mvp",
      "title": "Регистрация ударов с реального датчика",
      "description": "Как система я должна читать удары с датчика, подключённого через мини-джек (определяется как микрофон)",
      "acceptanceCriteria": [
        "Датчик подключается через navigator.mediaDevices.getUserMedia()",
        "Обработка аудиопотока через AudioContext.createMediaStreamSource()",
        "Определение удара по превышению порога амплитуды",
        "Нет ложных срабатываний от фоновых шумов",
        "Логирование событий подключения",
        "MicrophoneSensor реализован",
        "Датчик регистрирует прямые удары",
        "Нет ложных срабатываний",
        "Проблема подключения с 5-й попытки решена (изолирован в модуль)",
        "Тесты на реальном датчике"
      ],
      "priority": 8,
      "passes": true,
      "technicalNotes": "MicrophoneSensor реализован с Web Audio API. Параметры: threshold=0.3, cooldown=500ms (подобраны при тестировании на реальном датчике). Логирование всех шагов подключения. Обработка отзыва разрешения через событие 'ended'.",
      "relatedFiles": ["src/web/js/SensorManager.js", "src/web/js/sensors/MicrophoneSensor.js"]
    },
    {
      "id": "US-005",
      "phase": "mvp",
      "title": "Анализ точности попадания в ритм",
      "description": "Как система я должна определить, попал ли удар в такт метронома, и вычислить отклонение",
      "acceptanceCriteria": [
        "Сравнение времени удара с временем бита метронома",
        "Определение зоны попадания по порогам: Perfect ≤75ms, Good ≤150ms, Miss >150ms",
        "Хранение статистики: количество ударов, количество попаданий",
        "Расчёт процента точности",
        "Алгоритм анализа реализован",
        "Порог точности подобран при тестировании",
        "Статистика накапливается в течение занятия",
        "Тесты на граничные случаи (удар точно в бит, удар с отклонением)"
      ],
      "priority": 5,
      "passes": true,
      "technicalNotes": "Модуль RhythmAnalyzer.js. Методы: recordHit(hitTime), getAccuracy(), reset(). Логика: |hitTime - expectedBeatTime| <= threshold → попадание. Порог ±100ms подтверждён.",
      "relatedFiles": ["src/web/js/RhythmAnalyzer.js", "src/web/js/app.js"]
    },
    {
      "id": "US-006",
      "phase": "mvp",
      "title": "Визуальная обратная связь (анимация)",
      "description": "Как ребёнок я хочу видеть, попал ли я в ритм (зелёный = успех, красный = промах)",
      "acceptanceCriteria": [
        "Одна локация с простой анимацией (круг/фигура)",
        "При попадании: зелёный цвет, успешная анимация",
        "При промахе: красный цвет, анимация ошибки",
        "Анимация синхронизирована с метрономом (пульсирует в такт)",
        "Минимум текста, максимум визуальной обратной связи",
        "Анимация реализована (Canvas или CSS)",
        "Реагирует на события ударов",
        "Понятна детям 6-12 лет (проверено с тестерами)",
        "Плавная, без лагов"
      ],
      "priority": 4,
      "passes": true,
      "technicalNotes": "Canvas или CSS animations. Подписка на события из RhythmAnalyzer. Простая анимация: круг растёт/сжимается в такт метроному",
      "relatedFiles": ["src/web/js/Animator.js", "src/web/styles/main.css"]
    },
    {
      "id": "US-007",
      "phase": "mvp",
      "title": "Экран статистики после занятия",
      "description": "Как педагог я хочу увидеть результаты занятия (процент точности, количество ударов)",
      "acceptanceCriteria": [
        "Показывается после окончания времени или нажатия Стоп",
        "Отображает: процент точности, количество ударов, время занятия",
        "Большие цифры, понятные детям",
        "Кнопка Новое занятие для возврата в меню",
        "Экран статистики реализован",
        "Данные корректны (сверены с логами)",
        "UI читаемый и яркий",
        "Возврат в меню работает"
      ],
      "priority": 6,
      "passes": true,
      "technicalNotes": "Stats Screen с тремя показателями: точность (%), ударов, время (M:SS). Данные берутся из RhythmAnalyzer.getAccuracy(). Переход: Session → Stats → Setup.",
      "relatedFiles": ["src/web/index.html", "src/web/styles/main.css", "src/web/js/app.js"]
    },
    {
      "id": "US-008",
      "phase": "mvp",
      "title": "Управление занятием (Start/Stop, таймер)",
      "description": "Как педагог я хочу запустить занятие, остановить досрочно, видеть оставшееся время",
      "acceptanceCriteria": [
        "Кнопка Старт запускает метроном, датчик и таймер",
        "Кнопка Стоп останавливает всё и показывает статистику",
        "Таймер показывает оставшееся время",
        "По истечении времени автоматически переход к статистике",
        "Обратный отсчёт 3-2-1 перед началом занятия",
        "Кнопки работают",
        "Таймер корректен",
        "Автоматическое завершение по таймеру",
        "Все модули (метроном, датчик, анализ) синхронизированы"
      ],
      "priority": 7,
      "passes": true,
      "technicalNotes": "Координация между MetronomeEngine, SensorManager, RhythmAnalyzer. Таймер через setInterval (некритично для точности). Переход между экранами: Setup → Session → Stats. Обратный отсчёт 3-2-1 с возможностью прерывания.",
      "relatedFiles": ["src/web/js/app.js", "src/web/index.html", "src/web/styles/main.css"]
    },
    {
      "id": "US-009",
      "phase": "mvp",
      "title": "Зоны точности попадания (зелёная/жёлтая/красная)",
      "description": "Как ребёнок я хочу видеть градацию качества попадания (отлично/хорошо/мимо), а не только бинарный результат",
      "acceptanceCriteria": [
        "Три зоны точности с настраиваемыми порогами",
        "Зелёная зона: отличное попадание (порог TBD)",
        "Жёлтая зона: неплохое попадание (порог TBD)",
        "Красная зона: промах",
        "Визуальная обратная связь соответствует зоне",
        "Статистика учитывает зоны отдельно",
        "Пороги подобраны для детей разных возрастов"
      ],
      "priority": 9,
      "passes": true,
      "technicalNotes": "Пороги: Perfect ≤75ms, Good ≤150ms, Miss >150ms (фиксированные, адаптивные — будущее расширение). RhythmAnalyzer возвращает zone: 'perfect'|'good'|'miss'. Stats Screen показывает три числа по зонам. Animator рисует волны разных цветов (зелёный/жёлтый/красный).",
      "relatedFiles": ["src/web/js/RhythmAnalyzer.js", "src/web/js/Animator.js", "src/web/js/app.js", "src/web/index.html", "src/web/styles/main.css"]
    },

    {
      "id": "US-010",
      "phase": "v2",
      "title": "Редизайн UI всех экранов",
      "description": "Как ребёнок я хочу видеть яркий, красочный интерфейс, чтобы мне было интересно заниматься",
      "acceptanceCriteria": [
        "Новая цветовая палитра — яркая, детская, привлекательная",
        "Setup Screen: крупные элементы, иконки, визуальный стиль понятный ребёнку",
        "Session Screen: минималистичный, фокус на анимации, крупный таймер",
        "Stats Screen: крупные числа, иконки для зон, праздничный стиль",
        "Кнопки минимум 60px высота, скруглённые, с hover/active эффектами",
        "Шрифт читаемый, контрастный, не менее 18px для основного текста",
        "Адаптивность: работает на экране больничного ПК (не мобильный, но разные разрешения)",
        "Нет внешних зависимостей — чистый CSS (PixiJS только для анимации сессии)",
        "Все функции MVP работают после редизайна (регрессионное тестирование)"
      ],
      "priority": 10,
      "passes": true,
      "technicalNotes": "Только HTML/CSS. Не трогать JS-логику. Файлы: index.html, styles/main.css. Дизайн должен учитывать Windows 7 + Chrome.",
      "relatedFiles": ["src/web/index.html", "src/web/styles/main.css"]
    },
    {
      "id": "US-011",
      "phase": "v2",
      "title": "Интеграция PixiJS для анимаций",
      "description": "Как система я должна рендерить анимации через PixiJS (WebGL) вместо Canvas 2D для более качественной графики",
      "acceptanceCriteria": [
        "PixiJS подключён через CDN",
        "Текущий Canvas-аниматор (Animator.js) заменён на PixiJS-рендерер",
        "Базовая анимация работает: фоновая пульсация в такт метроному",
        "Реакция на удары: визуальный эффект по зонам (perfect/good/miss)",
        "Плавность 60fps на целевом оборудовании",
        "Fallback: если WebGL недоступен — показать сообщение (не падать молча)",
        "API аниматора не меняется для app.js: start(), stop(), onHit(result)",
        "Стабильные 60fps на Windows 7 + Chrome",
        "Нет утечек памяти при длительной работе (10+ минут)"
      ],
      "priority": 11,
      "passes": false,
      "technicalNotes": "Заменить Animator.js на PixiJS-версию. PixiJS через CDN. Сохранить тот же API для app.js. Протестировать WebGL на Windows 7 Chrome — если медленно, рассмотреть Canvas fallback в PixiJS.",
      "relatedFiles": ["src/web/js/Animator.js", "src/web/js/app.js", "src/web/index.html"]
    },
    {
      "id": "US-012",
      "phase": "v2",
      "title": "Система локаций (архитектура)",
      "description": "Как система я должна поддерживать подключение разных анимационных «миров», чтобы ребёнок мог выбирать локацию",
      "acceptanceCriteria": [
        "Общий интерфейс локации: init(container), onBeat(), onHit(zone), destroy()",
        "Локация — отдельный JS-модуль",
        "Аниматор делегирует рендеринг текущей локации",
        "Выбор локации на Setup Screen (пока одна, но UI готов для нескольких)",
        "Переключение локации не требует перезагрузки страницы",
        "Добавление новой локации = создание нового модуля + регистрация"
      ],
      "priority": 12,
      "passes": false,
      "technicalNotes": "Паттерн: LocationRegistry хранит список доступных локаций. Каждая локация экспортирует объект с методами init/onBeat/onHit/destroy. Аниматор при старте вызывает location.init(pixiContainer), при остановке — location.destroy(). Файлы: js/locations/LocationRegistry.js, js/locations/ForestLocation.js.",
      "relatedFiles": ["src/web/js/Animator.js", "src/web/js/app.js", "src/web/index.html"]
    },
    {
      "id": "US-013",
      "phase": "v2",
      "title": "Локация «Лес/Природа»",
      "description": "Как ребёнок я хочу видеть лесную сцену, где деревья, цветы и бабочки реагируют на мои удары в такт",
      "acceptanceCriteria": [
        "Лесная сцена: деревья, цветы, бабочки (PixiJS спрайты)",
        "onBeat(): фоновая анимация в такт (покачивание деревьев, движение бабочек)",
        "onHit('perfect'): яркий позитивный эффект (цветы распускаются, частицы, вспышка)",
        "onHit('good'): умеренный позитивный эффект",
        "onHit('miss'): негативная реакция (листья опадают, потемнение)",
        "Анимация плавная, не перегружает экран",
        "Графика яркая, детская, понятная без текста",
        "Работает на Windows 7 + Chrome без тормозов",
        "Нет утечек памяти при длительной работе (спрайты/частицы корректно уничтожаются)"
      ],
      "priority": 13,
      "passes": false,
      "technicalNotes": "Модуль ForestLocation.js реализует интерфейс локации. Ассеты: либо процедурная графика (PixiJS Graphics), либо простые спрайты (SVG/PNG). Для MVP локации лучше начать с процедурной графики — проще, нет зависимости от ассетов. Частицы для эффектов при perfect-ударах.",
      "relatedFiles": ["src/web/js/locations/ForestLocation.js"]
    }
  ]
}
