# Beat Buddy — PRD (Product Requirements Document)

## Проблема
Детям сложно развить чувство ритма. Нет интерактивных инструментов для тренировки ритма с обратной связью.

## Решение
Веб-приложение для тренировки чувства ритма. Ребёнок под руководством педагога слушает метроном в наушниках и бьёт в такт по датчику на перчатке. Приложение анализирует точность попадания в ритм и даёт визуальную обратную связь через анимацию.

## Пользователь
Дети 6-12 лет, занимающиеся с педагогом. Приложение управляется педагогом, ребёнок взаимодействует через датчик удара.

## User Journey

1. Педагог надевает на ребёнка наушники и перчатку с датчиком удара
2. Педагог открывает приложение в браузере
3. Выбирает локацию (визуальный интерактив)
4. Настраивает темп метронома (BPM 50-70)
5. Устанавливает время занятия (1-60 минут)
6. Нажимает "Старт"
7. Ребёнок слышит метроном в наушниках и бьёт по датчику в такт
8. На экране — анимация локации: попадание в ритм → позитивная реакция, промах → негативная
9. По истечении времени — статистика: точность по зонам (Perfect/Good/Miss), количество ударов
10. Возврат в меню для нового занятия

---

## MVP (v1.0) — ГОТОВО

Реализовано в феврале 2026. Все US-001..US-009 завершены.

- Метроном 50-70 BPM через Web Audio API (<10ms задержка)
- Датчик удара: MicrophoneSensor (пьезодатчик через мини-джек) + KeyboardSensor (dev-режим)
- Три зоны точности: Perfect (≤75ms), Good (≤150ms), Miss (>150ms)
- Визуальная обратная связь — цветные волны на Canvas
- Экраны: Setup → Countdown → Session → Stats
- Таймер, обратный отсчёт 3-2-1, автозавершение, кнопка Stop

---

## V2 — Текущий этап

### Главная цель
Качественный UI и анимации, которые удерживают внимание ребёнка. MVP функционально работает, но визуально скучный — волновая анимация не вызывает интереса.

### Что делаем

1. **Полный редизайн UI** — новый визуальный стиль всех экранов (Setup, Session, Stats). Яркий, детский, привлекательный.
2. **PixiJS для анимаций** — замена Canvas на PixiJS (WebGL) для интерактивной графики: спрайты, частицы, эффекты.
3. **Система локаций** — разные анимационные "миры". Каждая локация — отдельный модуль с уникальной графикой и реакциями на ритм.
4. **Первая локация: Лес/Природа** — деревья, цветы, бабочки реагируют на удары в такт.

### На потом (после V2)

5. Адаптивные пороги по возрасту/уровню
6. Сохранение истории занятий

---

## Технологический стек

**MVP:** Чистый HTML/CSS/JS, Web Audio API, Canvas

**V2 (текущий):**
- **PixiJS** — WebGL-рендерер для анимаций локаций
- **Vanilla JS + CSS** — для UI экранов (Setup, Stats). У нас 3 экрана, фреймворк не нужен.
- **Web Audio API** — метроном и датчик (без изменений)
- **localStorage** — настройки
- Нет бэкенда, всё локально в браузере

---

## Out of Scope

- Авторизация пользователей
- Бэкенд/сервер
- Музыкальные треки (только метроном)
- Кнопка "Пауза" (только "Стоп")
- 3D-анимация
- Настройка размера (4/4, 3/4) и громкости метронома

## Внешние системы

- Web Audio API для метронома и датчика-микрофона
- PixiJS (CDN) для анимаций
- Нет внешних API, БД, очередей

## Ограничения

- Работает в браузере (не требует установки)
- Низкая задержка аудио (<10ms для метронома)
- Простой интерфейс, понятный детям 6-12 лет
- Разработка на Mac, боевой режим — больничный ПК с Windows 7 и Chrome

## Критерии успеха

- Ребёнок занимается более 5 минут без потери интереса
- Анимация удерживает внимание и вызывает интерес
- Педагог может провести занятие без технических сбоев
- Датчик стабильно реагирует на удары
- Обратная связь понятна ребёнку

---

## Архитектурные требования

### Датчик (реализовано)
- Модуль `SensorManager.js` с двумя реализациями: KeyboardSensor (dev), MicrophoneSensor (prod)
- API: `connect()`, `disconnect()`, `onHit(callback)`, `getStatus()`
- Переключение через UI (чекбокс Dev Mode)
- Параметры: threshold=0.3, cooldown=500ms

### Система локаций (V2)
- Каждая локация — отдельный JS-модуль
- Общий интерфейс: `init(container)`, `onBeat()`, `onHit(zone)`, `destroy()`
- Рендеринг через PixiJS
- Первая локация: Лес/Природа

---

## Решённые вопросы

| Вопрос | Решение |
|--------|---------|
| Возраст | 6-12 лет |
| Диапазон BPM | 50-70 BPM |
| Пороги точности | Perfect ≤75ms, Good ≤150ms, Miss >150ms |
| Датчик | Пьезодатчик через мини-джек, threshold=0.3, cooldown=500ms |
| Стек анимаций V2 | PixiJS (WebGL, 2D) |
| Первая локация | Лес/Природа |

## Риски

- **Производительность PixiJS на Windows 7:** WebGL может работать медленнее на старом оборудовании. Нужно тестирование. Fallback на Canvas.
- **Удержание внимания:** Качество анимации критично. Итеративный процесс с тестированием на реальных детях.
- **Стабильность датчика:** Проблема подключения решена (изолировано в SensorManager), но нужен мониторинг при длительных сессиях.
