# Beat Buddy — PRD (Product Requirements Document)

## Проблема
Детям сложно развить чувство ритма. Нет интерактивных инструментов для тренировки ритма с обратной связью.

## Решение
Веб-приложение для тренировки чувства ритма. Ребёнок под руководством педагога слушает метроном в наушниках и бьёт в такт по датчику на перчатке. Приложение анализирует точность попадания в ритм и даёт визуальную обратную связь через анимацию.

## Пользователь
Дети 3-15 лет, занимающиеся с педагогом. Приложение управляется педагогом, ребёнок взаимодействует через датчик удара.

## User Journey

1. Педагог надевает на ребёнка наушники и перчатку с датчиком удара
2. Педагог открывает приложение в браузере
3. Выбирает одну локацию (визуальный интерактив)
4. Настраивает темп метронома (BPM)
5. Устанавливает время занятия (например, 10 минут)
6. Нажимает "Старт"
7. Ребёнок слышит метроном в наушниках и бьёт по датчику в такт
8. На экране показывается анимация: при точном попадании — успешное действие, при промахе — ошибка
9. По истечении времени показывается статистика: процент точности и количество ударов
10. Возврат в меню для нового занятия

## MVP Scope

### Обязательные функции
- Метроном с регулируемым темпом (BPM)
- Чтение данных с датчика удара через Web Audio API (датчик подключён как микрофон через мини-джек)
- Анализ точности попадания в ритм (отклонение TBD, подберём при тестировании)
- Одна локация с простой анимацией:
  - Круг или простая фигура растёт/сжимается в такт метроному
  - При точном попадании — зелёный цвет, успешная анимация
  - При промахе — красный цвет, анимация ошибки
- Настройка времени занятия
- Кнопка "Стоп" для досрочного завершения
- Экран статистики в конце: процент точности и количество ударов

### Технические требования
- Веб-приложение (работает в браузере)
- Низкая задержка аудио (точный метроном через Web Audio API)
- Простой интерфейс с большими кнопками для детей
- Датчик: подключается через мини-джек, определяется как микрофон, реагирует только на прямой удар (не ловит фоновые шумы)

## Out of Scope

- Авторизация пользователей
- Сохранение результатов тренировок
- Разные уровни сложности
- Музыкальные треки (только метроном)
- Кнопка "Пауза" (в MVP только "Стоп")
- Сложная анимация с персонажами (отложено на потом)
- Настройка размера (4/4, 3/4) и громкости метронома (в MVP фиксированы)

## Внешние системы

- Web Audio API для метронома и чтения данных с датчика-микрофона
- Нет внешних API, БД, очередей (всё работает локально в браузере)

## Ограничения

- Работает в браузере (не требует установки)
- Низкая задержка аудио (<10ms для метронома)
- Простой интерфейс, понятный детям 3-15 лет

## Критерии успеха

- Ребёнок занимается более 5 минут без потери интереса
- Педагог может провести полноценное занятие без технических сбоев
- Датчик стабильно реагирует на удары
- Обратная связь понятна ребёнку (он понимает, попал или нет)

## Технологический стек

**Выбор:** Чистый HTML/CSS/JS (без бэкенда)

**Обоснование:**
- Всё работает локально в браузере (метроном, датчик, анализ, анимация)
- Web Audio API для метронома и микрофона
- Canvas или CSS для анимации
- Нет необходимости в сервере для MVP
- Быстрый старт, простая разработка
- Соответствует принципу YAGNI

**Миграция на бэкенд (если потребуется):**
- Добавим FastAPI + SQLite для сохранения результатов
- Фронтенд останется независимым (добавим fetch к API)
- Или localStorage для локального сохранения без сервера

## Открытые вопросы

1. **Точность попадания:** Какое отклонение считать "попал"? (±50ms / ±100ms / ±200ms) → **TBD, определим при тестировании**
2. **Детали первой локации:** Окончательный вид анимации (круг, фигура, цвета) → **Определим при прототипировании**
3. **Диапазон BPM:** Минимальный и максимальный темп метронома → **50-70 BPM (подтверждено)**
4. **Фиксированные параметры:** Размер (4/4?), громкость по умолчанию → **TBD**

## Риски

- **Задержка аудио в браузере:** Web Audio API должен обеспечить <10ms задержку. Может потребоваться тестирование на разных устройствах.
- **Обработка сигнала с датчика:** Нужно правильно определить порог срабатывания, чтобы не было ложных срабатываний.
- **Удержание внимания детей:** Простая анимация может быть недостаточно интересной. Возможно, потребуется итерация дизайна.
- **Подключение датчика в приложении:** При тестировании датчик в нашем приложении работал только с 5-й попытки. В то же время в системе и на сторонних сайтах работал с первого раза. Проблема в логике подключения в нашем коде. Разработка на Mac, боевой режим — больничный ПК с Windows 7 и Chrome. **Критично:** логика подключения должна быть изолирована в отдельный модуль для быстрой отладки.

## Архитектурные требования

### Изоляция работы с датчиком
Логика подключения и чтения данных с микрофона/датчика ОБЯЗАТЕЛЬНО в отдельном модуле:
- Файл: `SensorManager.js` (или аналогичный)
- API: `connect()`, `disconnect()`, `onHit(callback)`, `getStatus()`
- **Две реализации:**
  1. **KeyboardSensor** — для разработки (нажатие на пробел = удар)
  2. **MicrophoneSensor** — для продакшена (реальный датчик через мини-джек)
- Переключение между реализациями через конфиг или UI (например, чекбокс "Dev mode")
- Логирует все события подключения для отладки
- Понятные сообщения об ошибках

**Обоснование:**
1. Датчик в нашем приложении работал только с 5-й попытки, хотя в системе и на сторонних сайтах — с первого раза. Проблема в нашем коде.
2. Датчик приедет только через 1-2 дня. Разработка и тестирование будут на Mac с клавиатурой (пробел = удар).
3. Изоляция позволит отлаживать подключение отдельно и легко переключаться между клавиатурой и датчиком.
