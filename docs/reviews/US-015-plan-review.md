## Ревью плана: US-015 «RunnerLocation — переход на спрайты»

### Вердикт: Требует доработки

### Соответствие архитектуре (project_state.md)

- План сохраняет контракт локации из `project_state.md`: `init/onBeat/onHit/destroy` и не требует изменений в `Animator.js`/`app.js`.
- Подход с сохранением игровой логики (`state machine`, `auto-stumble`) согласован с `project_state.md` (в т.ч. требование, что авто-спотыкание визуальное и не влияет на RhythmAnalyzer).
- Использование pre-allocated пула препятствий (`MAX_OBSTACLES=10`) совпадает с текущим паттерном `RunnerLocation`.

### Пробелы в плане

- В плане нет явных Acceptance Criteria (только общие шаги и список ручных проверок) → добавить измеримые AC (например, критерии по FPS/лагам, отсутствие визуальных артефактов, корректность состояний анимации).
- Шаг 2 (`Texture.from(url)` с фоновой загрузкой) не описывает стратегию готовности ассетов → добавить preload/ready-guard, иначе на старте возможны пустые/мигающие спрайты.
- Шаг 1 завязан на копирование из `/tmp/` → добавить воспроизводимый источник ассетов в репозитории и фиксацию лицензии/атрибуции (CC0) в проектной документации.
- Шаг 5 не фиксирует правила нормализации размеров/anchor для разных obstacle-спрайтов → добавить таблицу соответствий `type -> texture/scale/anchor/y-offset`, иначе визуально столкновения могут выглядеть некорректно при неизменной логике.
- Шаг 7 про `destroy()` не уточняет политику для текстур → добавить требование не уничтожать shared textures/baseTexture при stop/start циклах.

### Конфликты с существующей архитектурой

- Прямых конфликтов с архитектурой из `project_state.md` не обнаружено.
- Есть риск по эксплуатационным ограничениям из `project_state.md` (Windows 7 + Chrome, возможные проблемы WebGL): план не содержит отдельной проверки поведения спрайтовой версии в fallback/деградационном режиме.

### Рекомендации для доработки

1. Добавить в начало плана блок `Acceptance Criteria` с измеримыми условиями готовности и регрессионными проверками для `RunnerLocation`.
2. Дополнить Шаг 2 явным механизмом загрузки ассетов (preload + `assetsReady` guard в `onBeat`) и поведением до завершения загрузки.
3. Дополнить Шаг 1 артефактами воспроизводимости: откуда берутся исходники ассетов, как они нормализуются, где фиксируется лицензия CC0.
4. Дополнить Шаг 5 спецификацией визуального маппинга препятствий (`type`, размеры, anchor, baseline), чтобы согласовать спрайты с текущей геометрией геймплея.
5. Дополнить Шаг 9 проверками под ограниченное окружение из `project_state.md`: WebGL off/slow path, 5x start/stop, отсутствие утечек и визуальных провалов при незагруженных текстурах.
