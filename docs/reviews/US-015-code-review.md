## Код-ревью: US-015 — RunnerLocation переход на спрайты

### Вердикт: Требует доработки

### Замечания к коду

1. **[БЛОКЕР]** **`src/web/js/Animator.js`, строка 62**: при ошибке `location.init()` остаётся живой `pixiApp` без очистки.
   - Сейчас: в `start()` при исключении в блоке `try/catch` код делает `return` после установки fallback-статуса, но не вызывает очистку созданного Pixi-приложения.
   - Нужно: перед `return` в `catch` вызвать безопасный teardown (`ticker.remove`, `stage.removeChildren`, `pixiApp.destroy(...)`, `this.pixiApp = null`, `this.location = null`).
   - Причина: это утечка ресурсов при ошибке инициализации локации; противоречит требованию стабильной работы и отсутствия утечек в длительной сессии.

2. **[БЛОКЕР]** **`src/web/js/locations/RunnerLocation.js`, строка 138**: масштаб `TilingSprite` вычисляется по `texture.height` до гарантированной загрузки текстур.
   - Сейчас: `bgTexH = assets.bg.height || 750`, `groundTexH = assets.groundTop.height || 128`, `dirtTexH = assets.groundFill.height || 128`; при фоновом `Texture.from()` высота может быть временно `1`, и fallback не сработает.
   - Нужно: масштабировать по `texture.orig.height` (если доступно), либо дождаться `preloadAll()` до создания `TilingSprite`, либо пересчитывать scale после `baseTexture.valid`.
   - Причина: некорректный initial scale даёт визуально сломанный фон/землю (растянутые тайлы) и нарушает ожидаемый результат стори по спрайтовому рендерингу.

3. **[ЗАМЕЧАНИЕ]** **`src/web/js/locations/RunnerLocation.js`, строка 104**: флаг `assetsReady` не участвует в рендер-логике.
   - Сейчас: `assetsReady` выставляется в `true` после `preloadAll()`, но ни в `onBeat()`, ни в `init()` не используется для контроля первого кадра.
   - Нужно: либо убрать флаг как мёртвый код, либо использовать его как guard/триггер пересчёта scale и безопасного запуска спрайтовых слоёв.
   - Причина: текущая реализация создаёт ложное ощущение управления готовностью ассетов и усложняет сопровождение.

4. **[ЗАМЕЧАНИЕ]** **`docs/user_stories.json`, строка 1**: отсутствует запись `US-015`, из-за чего нельзя формально сверить код с AC/technicalNotes этой стори.
   - Сейчас: в `docs/user_stories.json` список заканчивается `US-013`.
   - Нужно: добавить `US-015` с `acceptanceCriteria`, `technicalNotes`, `relatedFiles` и ссылаться на них в ревью/разработке.
   - Причина: без этого отсутствует трассируемость «требование → реализация → проверка», и качество приёмки зависит только от плана/ручной интерпретации.
