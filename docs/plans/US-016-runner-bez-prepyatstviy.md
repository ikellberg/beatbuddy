# US-016: Runner без препятствий как основного фокуса

## Цель
Сфокусировать `RunnerLocation` на чистом ритм-фидбеке: действие героя зависит только от результата попадания в бит (`perfect/good/miss`), без obstacle-driven механик и auto-trigger, не связанных с ритмом.

## Acceptance Criteria (из стори)
1. В `RunnerLocation` убраны препятствия как ключевой визуальный и игровой элемент.
2. Прыжок запускается только по результату попадания в бит (`perfect/good`).
3. Спотыкание запускается только по `miss`.
4. Авто-спотыкание/внешние триггеры, не связанные с ритмом, отключены.
5. Сцена остаётся визуально живой без препятствий (фон, бег, эффекты).
6. `RhythmAnalyzer` и подсчёт статистики работают без изменений.
7. Производительность и стабильность не хуже текущей версии.

## Затрагиваемые файлы
- `src/web/js/locations/RunnerLocation.js` (основные изменения)
- `src/web/js/Animator.js` (ожидается без изменений; только валидация интеграции)
- `src/web/js/app.js` (ожидается без изменений; только валидация интеграции)

## Vertical Slices

### Slice 1: Удалить obstacle/auto-stumble механику в RunnerLocation
Изменения:
1. Убрать obstacle-пул, контейнер препятствий и связанный state (`MAX_OBSTACLES`, `obstacleSprites`, `obstacleShadows`, `obstacles`, `OBSTACLE_MAP`, `_updateObstacles`).
2. Удалить auto-stumble на битах (логика `hitThisBeat`/`prevBeatCount`/`LEAD_IN_BEATS` как триггер спотыкания при пропуске).
3. Оставить `onHit(zone)` как единственный источник действий героя:
   - `perfect/good` -> прыжок.
   - `miss` -> спотыкание.

Проверка slice:
1. На обычном тике (`onBeat`) без ударов герой не спотыкается автоматически.
2. После `onHit({zone:'miss'})` герой спотыкается.
3. После `onHit({zone:'perfect'|'good'})` герой прыгает.

### Slice 2: Сохранить «живость» сцены без препятствий
Изменения:
1. Оставить и при необходимости подправить фоновые слои (sky/clouds/ground/grass), бег героя, эффекты/частицы.
2. Привязать world offset для прокрутки только к визуальным слоям (без obstacle spacing как игровой сущности), чтобы сцена не выглядела статичной.
3. Проверить, что эффекты попаданий (`ring/trail/shake`) работают как прежде.

Проверка slice:
1. Сцена непрерывно «живёт» при проигрывании (параллакс/прокрутка/бег).
2. Нет пустых ссылок/ошибок после удаления obstacle-логики.

### Slice 3: Регрессионная валидация интеграции
Изменения:
1. Убедиться, что API локации не изменился (`init/onBeat/onHit/destroy`).
2. Проверить, что `Animator` и `app.js` не требуют правок.
3. Прогнать ручные сценарии start/stop и смены локаций.

Проверка slice:
1. Статистика (`perfect/good/miss`) продолжает считаться через существующий `RhythmAnalyzer`.
2. Нет регрессий при переключении между `default/forest/runner`.
3. Повторные start/stop не приводят к ошибкам или деградации.

## Технические детали реализации
1. Вынести прокрутку сцены на отдельную величину (`worldScrollStep`), чтобы не зависеть от obstacle spacing.
2. Удалить неиспользуемые поля/константы после удаления obstacle-кода.
3. Сохранить логику состояний героя (`running/jumping/stumbling`) и текущие длительности анимаций.
4. В `destroy()` убрать уничтожение объектов, которые больше не создаются.

## Риски и контроль
1. Риск: после удаления obstacle spacing «сломается» прокрутка облаков/травы.
   - Контроль: ввести независимый scroll spacing и проверить формулы в `_drawClouds`/`_drawGrassOverlay`.
2. Риск: случайно нарушить поведение `onBeat` и фазы.
   - Контроль: не трогать вычисление `phase/beatsFromStart`, менять только реактивную часть раннера.
3. Риск: утечки/ошибки destroy из-за неполной очистки.
   - Контроль: синхронизировать `init`/`destroy` списки объектов 1:1.

## Чек-лист тестирования
1. `runner`: без ударов нет авто-спотыканий.
2. `runner`: `perfect/good` даёт прыжок, `miss` даёт спотыкание.
3. `runner`: сцена визуально динамична без препятствий.
4. Start/Stop x5: без ошибок в консоли и визуальных провалов.
5. Переключение локаций (`default/forest/runner`): без регрессий.
6. Статистика на Stats Screen совпадает с ожидаемыми событиями попаданий.

## Что не меняем в этой стори
1. Пороги зон и алгоритм `RhythmAnalyzer`.
2. Структуру `Animator` и orchestration в `app.js`.
3. Новые UI-фичи (`streak`, реплики и т.д.) из следующих сторей.
