# US-009: –ó–æ–Ω—ã —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø–æ–ø–∞–¥–∞–Ω–∏—è

## –¶–µ–ª—å
–í–º–µ—Å—Ç–æ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ "–ø–æ–ø–∞–ª/–ø—Ä–æ–º–∞—Ö" –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—Ä–∏ –≥—Ä–∞–¥–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞: Perfect (–æ—Ç–ª–∏—á–Ω–æ), Good (—Ö–æ—Ä–æ—à–æ), Miss (–º–∏–º–æ).

## –ü–æ—Ä–æ–≥–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏
–í—ã–±—Ä–∞–Ω—ã –¥–ª—è –¥–µ—Ç–µ–π 6-12 –ª–µ—Ç (–º—è–≥–∫–∏–µ, –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–µ):

| –ó–æ–Ω–∞ | –ü–æ—Ä–æ–≥ | –¶–≤–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|------|----------|
| Perfect | ‚â§75ms | –ó–µ–ª—ë–Ω—ã–π (#4CAF50) | –û—Ç–ª–∏—á–Ω–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ |
| Good | ‚â§150ms | –ñ—ë–ª—Ç—ã–π (#FFC107) | –ù–µ–ø–ª–æ—Ö–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ |
| Miss | >150ms | –ö—Ä–∞—Å–Ω—ã–π (#f44336) | –ü—Ä–æ–º–∞—Ö |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ—Ä–æ–≥–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É/—É—Ä–æ–≤–Ω—é ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤ –±—É–¥—É—â–µ–º, –Ω–æ –Ω–µ –≤ —ç—Ç–æ–π story. –¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–¥—Å—Ç—Ä–æ–∏–º –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–µ—Ç—å–º–∏.

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. RhythmAnalyzer.js

**–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–Ω–æ–≤—ã–µ):**
```javascript
static PERFECT_THRESHOLD_MS = 75
static GOOD_THRESHOLD_MS = 150
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–æ–±–Ω–æ–≤–∏—Ç—å):**
```javascript
// –ë—ã–ª–æ:
this.accurateHits = 0
this.misses = 0

// –°—Ç–∞–Ω–µ—Ç:
this.perfectHits = 0
this.goodHits = 0
this.misses = 0
```

**recordHit() ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω—ã:**
```javascript
const absDeviation = Math.abs(deviation)

let zone
if (absDeviation <= RhythmAnalyzer.PERFECT_THRESHOLD_MS) {
  zone = 'perfect'
  this.perfectHits++
} else if (absDeviation <= RhythmAnalyzer.GOOD_THRESHOLD_MS) {
  zone = 'good'
  this.goodHits++
} else {
  zone = 'miss'
  this.misses++
}

return { zone, deviation, beatNumber }
```

**getAccuracy() ‚Äî –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç:**
```javascript
return {
  totalStrikes: this.totalStrikes,
  perfectHits: this.perfectHits,
  goodHits: this.goodHits,
  misses: this.misses
}
```

**reset() ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å:**
```javascript
this.perfectHits = 0
this.goodHits = 0
this.misses = 0
```

**–£–¥–∞–ª–∏—Ç—å:** `isHit`, `accurateHits`, `thresholdMs` ‚Äî –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã.

---

### 2. Animator.js

**–¶–≤–µ—Ç–∞ (–æ–±–Ω–æ–≤–∏—Ç—å this.colors):**
```javascript
this.colors = {
  perfect: '#4CAF50',  // –ó–µ–ª—ë–Ω—ã–π (–±—ã–ª–æ: hit)
  good: '#FFC107',     // –ñ—ë–ª—Ç—ã–π (–Ω–æ–≤—ã–π)
  miss: '#f44336',     // –ö—Ä–∞—Å–Ω—ã–π (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  rhythm: '#CCCCCC'    // –°–µ—Ä—ã–π (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
}
```

**onHit(result) ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É:**
```javascript
onHit(result) {
  if (!this.running) return

  // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –ø–æ –∑–æ–Ω–µ
  const color = this.colors[result.zone]  // 'perfect', 'good', –∏–ª–∏ 'miss'

  // –°–∫–æ—Ä–æ—Å—Ç—å –≤–æ–ª–Ω—ã: perfect –º–µ–¥–ª–µ–Ω–Ω–µ–µ, miss –±—ã—Å—Ç—Ä–µ–µ
  const speed = result.zone === 'miss'
    ? Animator.MISS_WAVE_SPEED
    : Animator.HIT_WAVE_SPEED

  this.hitWaves.push({
    radius: 0,
    color,
    alpha: 1.0,
    speed
  })
}
```

---

### 3. Stats Screen

**index.html ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å –±–ª–æ–∫ —Ç–æ—á–Ω–æ—Å—Ç–∏:**
```html
<!-- –ë—ã–ª–æ: –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç stats-accuracy -->
<!-- –°—Ç–∞–Ω–µ—Ç: —Ç—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ -->
<div class="stats-container">
  <div class="stat-item">
    <div class="stat-value stat-perfect" id="stats-perfect">0</div>
    <div class="stat-label">–û—Ç–ª–∏—á–Ω–æ</div>
  </div>

  <div class="stat-item">
    <div class="stat-value stat-good" id="stats-good">0</div>
    <div class="stat-label">–•–æ—Ä–æ—à–æ</div>
  </div>

  <div class="stat-item">
    <div class="stat-value stat-miss" id="stats-miss">0</div>
    <div class="stat-label">–ú–∏–º–æ</div>
  </div>
</div>
```

**main.css ‚Äî —Ü–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
```css
.stat-perfect { color: #4CAF50; }
.stat-good { color: #FFC107; }
.stat-miss { color: #f44336; }
```

**app.js ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å showStatsScreen():**
```javascript
const stats = rhythmAnalyzer.getAccuracy()

document.getElementById('stats-perfect').textContent = stats.perfectHits
document.getElementById('stats-good').textContent = stats.goodHits
document.getElementById('stats-miss').textContent = stats.misses
```

---

### 4. app.js ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞—Ä–æ–≤:**
```javascript
sensor.onHit((event) => {
  const result = rhythmAnalyzer.recordHit(event.timestamp / 1000)

  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏ –ø–æ –∑–æ–Ω–µ
  const icons = { perfect: 'üü¢ PERFECT', good: 'üü° GOOD', miss: 'üî¥ MISS' }
  const deviationText = result.deviation >= 0
    ? `+${result.deviation.toFixed(0)}ms`
    : `${result.deviation.toFixed(0)}ms`

  console.log(`[App] ${icons[result.zone]} | beat=${result.beatNumber} | deviation=${deviationText}`)

  animator.onHit(result)
})
```

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **RhythmAnalyzer.js** ‚Äî —è–¥—Ä–æ –ª–æ–≥–∏–∫–∏
2. **Animator.js** ‚Äî –≤–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
3. **Stats Screen** (index.html + main.css + app.js) ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –°—Ü–µ–Ω–∞—Ä–∏–π | Deviation | –û–∂–∏–¥–∞–µ–º–∞—è –∑–æ–Ω–∞ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å |
|----------|-----------|----------------|-----------|
| –¢–æ—á–Ω–æ –≤ –±–∏—Ç | 0ms | perfect | –ó–µ–ª—ë–Ω–∞—è –≤–æ–ª–Ω–∞ |
| –ù–∞ –≥—Ä–∞–Ω–∏—Ü–µ perfect | ¬±75ms | perfect | –ó–µ–ª—ë–Ω–∞—è –≤–æ–ª–Ω–∞ |
| –ß—É—Ç—å –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π | ¬±76ms | good | –ñ—ë–ª—Ç–∞—è –≤–æ–ª–Ω–∞ |
| –ù–∞ –≥—Ä–∞–Ω–∏—Ü–µ good | ¬±150ms | good | –ñ—ë–ª—Ç–∞—è –≤–æ–ª–Ω–∞ |
| –ü—Ä–æ–º–∞—Ö | ¬±151ms | miss | –ö—Ä–∞—Å–Ω–∞—è –≤–æ–ª–Ω–∞ |

**–ü–æ—Å–ª–µ –∑–∞–Ω—è—Ç–∏—è:**
- [ ] Stats Screen –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—Ä–∏ —á–∏—Å–ª–∞ (Perfect, Good, Miss)
- [ ] –¶–≤–µ—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∑–æ–Ω–∞–º
- [ ] –°—É–º–º–∞ —á–∏—Å–µ–ª = –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞—Ä–æ–≤
