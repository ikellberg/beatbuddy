---
name: implementing-user-story
description: >
  Этот скилл используется для начала работы над user story — полный цикл от погружения
  в контекст до финального коммита. Триггеры: "берём US-ХХХ", "следующая стори",
  "давай начнём работу", "/implementing-user-story US-ХХХ.
---

# Начало работы над User Story

Полный цикл работы над одной user story: контекст → планирование → реализация → завершение.

## Процесс

### 1. Погружение в контекст

Прочитать параллельно два файла:
- `project_state.md` — текущее состояние, бэклог, ключевые решения, структура проекта
- `docs/user_stories.json` — для конкретной story изучить acceptance criteria, technical notes.

Если story не указана явно — предложить верхнюю из Backlog в `project_state.md`.

При старте story обновить `project_state.md` → секция Current Sprint.

### 2. Планирование

1. Войти в `EnterPlanMode`
2. Исследовать кодебазу: прочитать файлы, которые будут затронуты
3. Составить план **только для этой одной story** (не для всего проекта)
4. Разбить на vertical slices — каждый слайс даёт отдельный рабочий инкремент
5. Сохранить план в `docs/plans/US-XXX-название.md`
6. Выйти через `ExitPlanMode` — ожидать утверждения пользователя

### 3. Реализация

- Работать по слайсам из плана
- После каждого слайса — **СТОП**, дать пользователю протестировать
- **Никогда** не коммитить без явного разрешения ("ок", "коммитим", "да")
- При обнаружении проблемы — исправить, снова дать протестировать
- 3 неудачные попытки исправить ошибку — **СТОП**, предложить другой подход

### 4. Ревью

Ревью может происходить на любом этапе — после плана или после кода. При получении замечаний:

- Приоритизировать: критичное (баги, нарушение архитектуры) важнее мелких улучшений
- Кратко ответить на каждое замечание — согласен/не согласен и почему
- Спорные моменты обсудить с пользователем перед внесением изменений
- Автор несёт ответственность за финальное решение (с учётом мнения пользователя)

### 5. Завершение story

Перед финальным коммитом обновить **два файла**:

**`docs/user_stories.json`:**
- Установить `"passes": true`
- Обновить `technicalNotes` если появились важные решения
- Обновить `relatedFiles` списком затронутых файлов

**`project_state.md`:**
- Перенести story из Current Sprint в Done
- Обновить Gotchas если появились грабли или неочевидные решения
- Обновить Architecture если изменилась структура системы

**Никогда** не коммитить без явного разрешения пользователя ("ок", "коммитим", "да"). Все изменения (код + трекинговые файлы) должны войти в один коммит.
